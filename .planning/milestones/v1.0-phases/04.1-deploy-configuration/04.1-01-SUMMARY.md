---
phase: 04.1-deploy-configuration
plan: 01
subsystem: infra
tags: [home-assistant, add-on, config, translations, versioning, lp-planner]

# Dependency graph
requires:
  - phase: 04-predictive-planner
    provides: LP Horizon Planner with 8 configurable fields (battery_min_soc, battery_max_soc, battery_charge_power_kw, feed_in_tariff_ct, ev_default_energy_kwh, sequencer_enabled, sequencer_default_charge_power_kw, rl_bootstrap_max_records)
provides:
  - version.py declaring VERSION = "6.0.0" as single source of truth
  - config.yaml with version 6.0.0, all 35 HA add-on config fields, complete options+schema parity
  - repository.yaml with channel: stable for HA add-on store listing
  - translations/en.yaml with English labels for all config fields including 8 new LP planner fields
  - translations/de.yaml with German labels for all config fields including 8 new LP planner fields
affects: [05-dynamic-buffer, deployment, HA-add-on-store]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "HA add-on config.yaml: options block + schema block must have 1:1 field parity"
    - "Translation files: 2-space indent for field key, 4-space indent for name/description"
    - "version.py as single source of truth; main.py imports VERSION dynamically — no hardcoded version strings"

key-files:
  created: []
  modified:
    - evcc-smartload/rootfs/app/version.py
    - evcc-smartload/config.yaml
    - repository.yaml
    - evcc-smartload/translations/en.yaml
    - evcc-smartload/translations/de.yaml

key-decisions:
  - "Version bumped from 5.0.7 to 6.0.0 — major version reflects LP Horizon Planner, PV forecasting, consumption forecasting capabilities added in Phase 3-4"
  - "config.yaml ends up with 35 options+schema fields (not 30 as estimated in plan) — original had 27, plus 8 new = 35; plan's 22+8=30 estimate was off but all 8 new fields correctly added"
  - "sequencer_enabled uses bare true (not quoted) in options and bool (not bool?) in schema — has explicit default so not optional"
  - "main.py verified to use f-string with VERSION import — no main.py edits needed, version change propagates automatically"

patterns-established:
  - "HA add-on config: always add new fields to BOTH options AND schema blocks in same order — HA requires 1:1 parity"
  - "HA translations: always add entries in BOTH en.yaml AND de.yaml for every config field — use (unit) suffix in name for numeric fields with units"

requirements-completed: [DEPLOY-02, DEPLOY-03, DEPLOY-05]

# Metrics
duration: 5min
completed: 2026-02-22
---

# Phase 4.1 Plan 01: Deploy Configuration Summary

**Version bumped to 6.0.0 with 8 LP planner fields added to HA add-on config.yaml options+schema and both translation files, plus channel: stable in repository.yaml**

## Performance

- **Duration:** ~5 min
- **Started:** 2026-02-22T20:20:00Z
- **Completed:** 2026-02-22T20:25:17Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments
- DEPLOY-02 closed: version.py and config.yaml both declare 6.0.0 — version is consistent across the codebase
- DEPLOY-03 closed: All 8 missing LP planner config fields added to config.yaml (options + schema parity) and translated in both en.yaml and de.yaml
- DEPLOY-05 closed: repository.yaml now includes channel: stable for proper HA add-on store listing
- Zero runtime Python code changed — pure metadata/config change, no risk of behavior regression

## Task Commits

Each task was committed atomically:

1. **Task 1: Version bump and repository metadata** - `59cb062` (chore)
2. **Task 2: Translation files for new config fields** - `203a0cf` (feat)

**Plan metadata:** `e68b6b2` (docs: complete plan)

## Files Created/Modified
- `evcc-smartload/rootfs/app/version.py` - VERSION bumped from 5.0.7 to 6.0.0
- `evcc-smartload/config.yaml` - version 6.0.0, description updated, 8 new LP planner fields in options+schema
- `repository.yaml` - added channel: stable
- `evcc-smartload/translations/en.yaml` - 8 new English labels for LP planner config fields
- `evcc-smartload/translations/de.yaml` - 8 new German labels for LP planner config fields

## Decisions Made
- Version 6.0.0 chosen (not 5.1.0) to reflect the magnitude of LP Horizon Planner + PV forecasting capabilities added in Phases 3-4
- config.yaml ends up with 35 fields total (original had 27, not 22 as estimated in plan) — all 8 new fields correctly added regardless of estimate
- sequencer_enabled: bare `true` in options, `bool` (not `bool?`) in schema — has explicit default so not optional

## Deviations from Plan

None - plan executed exactly as written. The field count discrepancy (35 vs estimated 30) is an estimation error in the plan, not a deviation — all 8 new fields were correctly added and verified via grep count of 16 (8 options + 8 schema).

## Issues Encountered
None.

## Next Phase Readiness
- HA add-on deployment artifacts complete: version, config schema, translations, repository metadata all consistent
- All 3 DEPLOY requirements (DEPLOY-02, DEPLOY-03, DEPLOY-05) from v1.0 audit now closed
- Phase 04.1 plan 01 complete — ready for any remaining deploy configuration plans or Phase 5

---
*Phase: 04.1-deploy-configuration*
*Completed: 2026-02-22*

## Self-Check: PASSED

- FOUND: evcc-smartload/rootfs/app/version.py
- FOUND: evcc-smartload/config.yaml
- FOUND: repository.yaml
- FOUND: evcc-smartload/translations/en.yaml
- FOUND: evcc-smartload/translations/de.yaml
- FOUND: .planning/phases/04.1-deploy-configuration/04.1-01-SUMMARY.md
- FOUND commit: 59cb062 (Task 1)
- FOUND commit: 203a0cf (Task 2)
