# v1.1 Smart EV Charging & evcc Control â€” SHIPPED 2026-02-27

## Phases

### Phase 9: Vehicle SoC Provider Fix (2/2 plans)
- KiaProvider: persistent VehicleManager, progressive backoff 2h->24h cap
- RenaultProvider: persistent aiohttp session, 401 retry once
- VehicleMonitor: evcc-live suppression (skip API poll when connected)
- Per-vehicle poll_interval_minutes, disabled flag
- Verification: 5/5 passed

### Phase 10: Poll Now Button + SoC Dashboard (2/2 plans)
- Fahrzeuge tab with vehicle cards, color-coded freshness aging
- Poll Now button with 5-min throttle, spinner, SSE live update
- Data source labels (API/Wallbox/Manuell)
- Verification: 5/5 passed

### Phase 11: evcc Mode Control + Override Detection (2/2 plans)
- EvccModeController: price-based mode selection (now/minpv/pv)
- Override detection + lifecycle (persists until EV disconnect or target SoC)
- Startup baseline adoption (no command on first cycle)
- Dashboard banners (override active, evcc unreachable)
- 29 unit tests
- Verification: 5/5 passed

### Phase 12: LP-Gated Battery Arbitrage (2/2 plans)
- battery_arbitrage.py: 7-gate logic for LP-authorized discharge
- Gates: EV connected, LP authorizes, now mode, profitable, 6h lookahead, floor SoC, mutual exclusion
- DynamicBufferCalc sync (reads same floor under lock)
- Dashboard arbitrage banner via SSE
- 13 unit tests
- Verification: 5/5 passed

## Key Decisions
- SmartLoad leads evcc charge modes; manual overrides respected until session ends
- Phase 11 + override detection ship as atomic deploy
- battery_arbitrage.py extracted as standalone module (testability)
- 7-gate sequential evaluation (fail-fast with reason reporting)

## Stats
- 4 phases, 8 plans, all verified
- 42 unit tests (29 mode controller + 13 arbitrage)
- Completed: 2026-02-27
