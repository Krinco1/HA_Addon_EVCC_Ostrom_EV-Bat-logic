---
milestone: v1.0
audited: 2026-02-22T21:00:00Z
status: gaps_found
scores:
  requirements: 9/9
  phases: 4/4
  integration: 14/18
  flows: 5/5
gaps:
  requirements: []
  integration:
    - id: "DEPLOY-01"
      summary: "config.yaml missing image: key — HA cannot pull pre-built container"
      severity: blocker
      affected_requirements: [PLAN-01, PLAN-02, PLAN-04, PLAN-05, RELI-01, RELI-02, RELI-03, RELI-04, RELI-05]
      evidence: "config.yaml has no image: field; no .github/workflows/ CI pipeline exists; HA OS devices cannot docker build locally"
    - id: "DEPLOY-02"
      summary: "Version mismatch — config.yaml/version.py report 5.0.7, code implements Phase 4 (v6.0+)"
      severity: major
      affected_requirements: []
      evidence: "version.py:1 VERSION='5.0.7'; config.yaml:3 version:'5.0.7'; main.py:2 docstring says v6.0; Phase 4 LP planner is live code"
    - id: "DEPLOY-03"
      summary: "config.yaml schema missing fields for LP planner — users cannot configure battery_charge_power_kw, battery_min/max_soc, feed_in_tariff_ct via HA UI"
      severity: major
      affected_requirements: [PLAN-01, RELI-04]
      evidence: "Config dataclass has defaults for all fields; config.yaml options/schema blocks omit them; HA UI shows no LP-related settings"
    - id: "DEPLOY-04"
      summary: "CHANGELOG.md and README.md stale — Phase 3 and Phase 4 features undocumented"
      severity: major
      affected_requirements: []
      evidence: "CHANGELOG.md last entry is v5.0.2; README.md describes v5.0 architecture only; /forecast, /events, HorizonPlanner missing from docs"
    - id: "DEPLOY-05"
      summary: "repository.yaml minimal — missing channel field"
      severity: minor
      affected_requirements: []
      evidence: "repository.yaml has name/url/maintainer only; no channel: stable declaration"
  flows: []
tech_debt:
  - phase: 04-predictive-planner
    items:
      - "StateStore.get_plan() is dead code — no caller (Phase 6 will use it)"
      - "ha_energy.start_entity_discovery_thread() helper is dead code — main.py inlines the thread"
      - "_compute_price_zones() uses single-price approximation, not per-slot tariff data"
  - phase: 03-data-foundation
    items:
      - "HA entity discovery result is display-only — ConsumptionForecaster queries InfluxDB with hardcoded measurement name"
      - "Phase 3 human_needed status: 4 items require live container observation"
  - phase: 04-predictive-planner
    items:
      - "HorizonPlanner inactive until ConsumptionForecaster.is_ready (requires 24h of InfluxDB data)"
      - "Phase 4 human_needed: scipy import, LP wall-clock time, test suite require container execution"
---

# v1.0 Milestone Audit Report

**Milestone:** v1.0 — SmartLoad v6
**Audited:** 2026-02-22
**Status:** GAPS FOUND — all code requirements satisfied, deploy pipeline broken

---

## Executive Summary

All 9 milestone requirements are code-complete and verified across 4 phases. Cross-phase wiring is correct — all 5 E2E flows complete without breaks. However, **the add-on cannot be deployed to Home Assistant** because `config.yaml` lacks an `image:` key, no CI/CD pipeline builds and pushes container images, and the version/documentation are stale. These are deploy-level gaps, not code-level gaps.

---

## Phase Verification Summary

| Phase | Status | Score | Requirements |
|-------|--------|-------|-------------|
| 1. State Infrastructure | PASSED | 7/7 | RELI-03 ✓, RELI-04 ✓ |
| 2. Vehicle Reliability | PASSED | 7/7 | RELI-01 ✓, RELI-02 ✓, RELI-05 ✓ |
| 3. Data Foundation | human_needed | 14/14 | PLAN-04 ✓, PLAN-05 ✓ |
| 4. Predictive Planner | PASSED | 5/5 | PLAN-01 ✓, PLAN-02 ✓ |

---

## Requirements 3-Source Cross-Reference

| Requirement | VERIFICATION.md | SUMMARY frontmatter | REQUIREMENTS.md | Final Status |
|-------------|----------------|---------------------|-----------------|-------------|
| RELI-01 | Phase 2: SATISFIED | 02-01: ✓ | [x] Complete | **satisfied** |
| RELI-02 | Phase 2: SATISFIED | 02-01: ✓ | [x] Complete | **satisfied** |
| RELI-03 | Phase 1: SATISFIED | 01-01: ✓ | [x] Complete | **satisfied** |
| RELI-04 | Phase 1: SATISFIED | 01-02: ✓ | [x] Complete | **satisfied** |
| RELI-05 | Phase 2: SATISFIED | 02-02: ✓ | [x] Complete | **satisfied** |
| PLAN-01 | Phase 4: SATISFIED | 04-03: ✓ | [x] Complete | **satisfied** |
| PLAN-02 | Phase 4: SATISFIED | 04-03: ✓ | [x] Complete | **satisfied** |
| PLAN-04 | Phase 3: SATISFIED | 03-03: ✓ | [x] Complete | **satisfied** |
| PLAN-05 | Phase 3: SATISFIED | 03-02, 03-03: ✓ | [x] Complete | **satisfied** |

**Orphaned requirements:** None — all 9 REQ-IDs assigned to Phases 1-4 are verified across all three sources.

---

## Integration Gaps (Blockers)

### DEPLOY-01: No container image pipeline (BLOCKER)

`config.yaml` has no `image:` field. No GitHub Actions workflow exists (`.github/workflows/` absent). HA OS devices cannot `docker build` locally — they rely on pre-built images from a container registry. **Without this, the add-on is uninstallable on production HA devices.**

**Fix:** Add `image:` key to `config.yaml`, create GitHub Actions workflow for multi-arch build + push to GHCR.

### DEPLOY-02: Version mismatch (MAJOR)

`version.py` and `config.yaml` both declare `5.0.7`. The codebase implements Phase 4 features (LP planner, forecasters, SSE). `main.py` docstring says `v6.0`. HA will report version 5.0.7 to the user while running v6.0+ code.

**Fix:** Update `version.py` and `config.yaml` to `6.0.0` (reflecting Phases 1-4 completion).

### DEPLOY-03: config.yaml schema incomplete (MAJOR)

Users cannot configure LP planner parameters through the HA UI:

| Missing field | Used by | Default |
|--------------|---------|---------|
| `battery_charge_power_kw` | LP formulation | 5.0 |
| `battery_min_soc` | LP SoC bounds, ConfigValidator | 10 |
| `battery_max_soc` | LP SoC bounds, ConfigValidator | 90 |
| `feed_in_tariff_ct` | LP objective | 8.0 |
| `ev_default_energy_kwh` | LP EV capacity fallback | 64.0 |
| `sequencer_enabled` | main.py, server.py | false |
| `sequencer_default_charge_power_kw` | LP, sequencer | 11.0 |
| `rl_bootstrap_max_records` | RL bootstrap cap | 1000 |

All have safe defaults in `Config` dataclass — app functions correctly. But users cannot tune them.

**Fix:** Add missing fields to `config.yaml` options + schema sections.

### DEPLOY-04: CHANGELOG.md and README.md stale (MAJOR)

CHANGELOG.md last entry: v5.0.2. README.md describes v5.0 architecture.

Missing documentation for:
- Phase 3: ConsumptionForecaster, PVForecaster, HA energy discovery, `/forecast` API, dashboard chart
- Phase 4: HorizonPlanner, LP plan storage, plan fallback chain, test suite
- API routes: `/forecast`, `/events`

**Fix:** Update CHANGELOG.md with v5.1-v6.0 entries. Update README.md architecture and API table.

### DEPLOY-05: repository.yaml minimal (MINOR)

Missing `channel: stable` — may prevent discovery on some HA installations.

---

## Cross-Phase Integration Results

**Connected exports:** 17/18 (94%)
**Orphaned export:** `StateStore.get_plan()` — defined but never called (Phase 6 consumer)
**E2E flows:** 5/5 complete

| Flow | Path | Status |
|------|------|--------|
| Config validation → error page | ConfigValidator → WebServer → error.html | ✓ Complete |
| Vehicle SoC refresh → sequencer handoff | VehicleMonitor → trigger_refresh → update_soc → plan | ✓ Complete |
| Forecast → LP plan → action → SSE | Forecasters → HorizonPlanner → StateStore → SSE → chart | ✓ Complete |
| Thread-safe state → SSE delivery | main loop → store.update(RLock) → broadcast → SSE clients | ✓ Complete |
| RL bootstrap memory cap | config → bootstrap_from_influxdb(max_records) | ✓ Complete |

---

## Tech Debt Summary

| Phase | Items | Severity |
|-------|-------|----------|
| Phase 3 | HA entity discovery is display-only (not wired to ConsumptionForecaster input) | Low |
| Phase 3 | `_compute_price_zones()` uses single-price approximation | Low |
| Phase 4 | `StateStore.get_plan()` dead code | Low |
| Phase 4 | `ha_energy.start_entity_discovery_thread()` dead code | Low |
| Phase 4 | HorizonPlanner inactive until 24h of InfluxDB data exists | By design |
| Phase 3+4 | Human verification items pending (8 total, all require Docker container) | Deferred |

**Total:** 6 items across 2 phases. None are blockers — all are deferred to future phases or by-design behavior.

---

_Audited: 2026-02-22_
_Auditor: Claude (gsd-audit-milestone)_
